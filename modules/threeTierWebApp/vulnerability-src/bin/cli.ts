#!/usr/bin/env node
const inquirer = require('inquirer');
import 'source-map-support/register';
import cdk = require('@aws-cdk/core');
import { SrcStack } from '../lib/src-stack';
// TODO output yml
inquirer
  .prompt([{
    name: 'vulnerabilities',
    type: 'checkbox',
    choices: [{
      name: 'S3 bucket issues - Unencrypted & public',
      value: 's3'
    }, {
      name: 'Ec2 issues - unpatched, open firewalls',
      value: 'ec2'
    }, {
      name: 'IAM issues - permissive IAM roles',
      value: 'iam'
    }, {
      name: 'RDS issues - open firewall, unencrypted storage',
      value: 'rds'
    }]
  }])
  .then((answers: { vulnerabilities: Array<string>}) => {
    // Use user feedback for... whatever!!
    console.log(answers);
    const app = new cdk.App({
      outdir: './',

    });
    new SrcStack(app, 'SrcStack', {
      vulnerabilityOptions: {
        s3: answers.vulnerabilities.includes('s3'),
        ec2: answers.vulnerabilities.includes('ec2'),
        iam: answers.vulnerabilities.includes('iam'),
        rds: answers.vulnerabilities.includes('rds')
      }
    });
    app.synth();
  });